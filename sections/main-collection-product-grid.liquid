<section class="main-product-section container">
  {% paginate collection.products by {{section.settings.products_per_page}} %}
  <div class="products-wrapper">
   {% for product in collection.products %}
    <div class="product-grid">
      <a href="{{product.url}}"><div class="product-image" style="background-image: url('{{product.featured_image | img_url: '1000x'}}');">
      {% if product.tags contains 'sale' or product.price < product.compare_at_price %}
        <span class="product-sale">Sale</span>
      {% endif %}
        {% if product.tags contains 'new' %}
          <span class="product-tag">New</span>
        {% endif %}
      </div></a>
      <div class="product-title popup-cart-title">
          <h4><a href="product.url">{{product.title}}</a></h4>
          {% if product.compare_at_price %}
            <span class="compare-price">{{product.compare_at_price | money}}</span>
          {% endif %}
          <span>{{product.price |  money}}</span>
       </div>
       <button class="add-to-cart-btn" data-product-variant="{{product.first_available_variant.id}}">Add to cart</button>
    </div>
   {% endfor %}
  </div>
  {% if paginate.pages > 1 %}
    {% render 'pagination', paginate: paginate %}
  {% endif %}
  {% endpaginate %}
</section>

{% schema %}
{
  "name": "Product Grid",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 8,
      "label": "Products per page"
    }
    ]
}
{% endschema %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script>
  $(document).ready(function(){
    $('.add-to-cart-btn').click(function(e){
    e.preventDefault();
    let button = $(this);
    button.text('Adding....')
    let variantID = $(this).data('product-variant');
    let quantity = 1;
    $.ajax({
      type:'POST',
      url: '/cart/add.js',
      data:{
        quantity: quantity,
        id: variantID
      },
      dataType: 'json',
      success: function(response){
        console.log(response)
        fetch(window.Shopify.routes.root + 'cart.js')
        .then(response => response.json())
        .then(data => {
          $('.cart-count-bubble span').text(data.item_count)
          console.log(data)
        })

        button.text('Add to Cart');
      }
    })

    })
  })
</script>